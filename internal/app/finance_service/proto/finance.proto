syntax = "proto3";

option go_package = "github.com/go-park-mail-ru/2025_2_VKarmane/internal/finance_service/proto;proto";

package finance;

import "google/protobuf/timestamp.proto";

// protoc \
//  --go_out=. \
//  --go-grpc_out=. \
//  --go_opt=paths=source_relative \
//  --go-grpc_opt=paths=source_relative \
//  internal/app/finance_service/proto/finance.proto

message Account {
    int32 id = 1;
    double balance = 2;
    string type = 3;
    int32 currency_id = 4;
    google.protobuf.Timestamp created_at = 5;
    google.protobuf.Timestamp updated_at = 6;
}

message CreateAccountRequest {
    int32 user_id = 1;
    double balance = 2;
    string type = 3;
    int32 currency_id = 4;
}

message UpdateAccountRequest {
    int32 user_id = 1;
    int32 account_id = 2;
    double balance = 3;
}

message AccountRequest {
    int32 user_id = 1;
    int32 account_id = 2;
}

message UserID {
    int32 user_id = 1;
}

message ListAccountsResponse {
    repeated Account accounts = 1;
}

message Operation {
    int32 id = 1;
    int32 account_id = 2;
    int32 category_id = 3;
    string category_name = 4;
    string type = 5;
    string status = 6;
    string description = 7;
    string receipt_url = 8;
    string name = 9;
    double sum = 10;
    int32 currency_id = 11;
    google.protobuf.Timestamp created_at = 12;
    google.protobuf.Timestamp date = 13;
}

message OperationInList {
    int32 id = 1;
    int32 account_id = 2;
    int32 category_id = 3;
    string category_name = 4;
    string type = 5;
    string description = 6;
    string name = 7;
    string category_logo_hashed_id = 8;
    string category_logo = 9;
    double sum = 10;
    int32 currency_id = 11;
    google.protobuf.Timestamp created_at = 12;
    google.protobuf.Timestamp date = 13;
}

message CreateOperationRequest {
    int32 user_id = 1;
    int32 account_id = 2;
    optional int32 category_id = 3;
    string type = 4;
    string name = 5;
    string description = 6;
    double sum = 7;
    optional google.protobuf.Timestamp date = 8;
}

message UpdateOperationRequest {
    int32 user_id = 1;
    int32 account_id = 2;
    int32 operation_id = 3;
    optional int32 category_id = 4;
    optional string name = 5;
    optional string description = 6;
    optional double sum = 7;
    optional google.protobuf.Timestamp created_at = 8;
}

message OperationRequest {
    int32 user_id = 1;
    int32 account_id = 2;
    int32 operation_id = 3;
}

message ListOperationsResponse {
    repeated OperationInList operations = 1;
}

message Category {
    int32 id = 1;
    int32 user_id = 2;
    string name = 3;
    string description = 4;
    string logo_hashed_id = 5;
    string logo_url = 6;
    google.protobuf.Timestamp created_at = 7;
    google.protobuf.Timestamp updated_at = 8;
}

message CreateCategoryRequest {
    int32 user_id = 1;
    string name = 2;
    string description = 3;
    string logo_hashed_id = 4;
}

message UpdateCategoryRequest {
    int32 user_id = 1;
    int32 category_id = 2;
    optional string name = 3;
    optional string description = 4;
    optional string logo_hashed_id = 5;
}

message CategoryRequest {
    int32 user_id = 1;
    int32 category_id = 2;
}

message ListCategoriesResponse {
    repeated Category categories = 1;
}

message CategoryWithStats {
    Category category = 1;
    int32 operations_count = 2;
}

message ListCategoriesWithStatsResponse {
    repeated CategoryWithStats categories = 1;
}

service FinanceService {
    // Account methods
    rpc CreateAccount(CreateAccountRequest) returns (Account);
    rpc GetAccount(AccountRequest) returns (Account);
    rpc GetAccountsByUser(UserID) returns (ListAccountsResponse);
    rpc UpdateAccount(UpdateAccountRequest) returns (Account);
    rpc DeleteAccount(AccountRequest) returns (Account);
    
    // Operation methods
    rpc CreateOperation(CreateOperationRequest) returns (Operation);
    rpc GetOperation(OperationRequest) returns (Operation);
    rpc GetOperationsByAccount(AccountRequest) returns (ListOperationsResponse);
    rpc UpdateOperation(UpdateOperationRequest) returns (Operation);
    rpc DeleteOperation(OperationRequest) returns (Operation);
    
    // Category methods
    rpc CreateCategory(CreateCategoryRequest) returns (Category);
    rpc GetCategory(CategoryRequest) returns (CategoryWithStats);
    rpc GetCategoriesByUser(UserID) returns (ListCategoriesResponse);
    rpc GetCategoriesWithStatsByUser(UserID) returns (ListCategoriesWithStatsResponse);
    rpc UpdateCategory(UpdateCategoryRequest) returns (Category);
    rpc DeleteCategory(CategoryRequest) returns (Category);
}
